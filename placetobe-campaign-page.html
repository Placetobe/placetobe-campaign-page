<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../google-youtube/google-youtube.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../caas-campaign/caas-campaign.html">
<link rel="import" href="../caas-campaign-files/caas-campaign-files.html">
<link rel="import" href="../placetobe-behaviors/placetobe-styles-behavior.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">
<link rel="import" href="../placetobe-campaign-stats-card/placetobe-campaign-stats-card.html">
<link rel="import" href="../placetobe-navigation-bar/placetobe-navigation-bar.html">

<!--
`placetobe-campaign-page`
Placetobe Campaign Page

@demo demo/index.html 
-->

<dom-module id="placetobe-campaign-page">
  <template>
    <style>
      :host {
        display: block;
        color: var(--placetobe-color-darkblue);
      }

      :host header,
      :host main {
        max-width: var(--placetobe-two-column-width);
        margin-left: auto;
        margin-right: auto;     
        padding: 0 18px;   
      }

      :host header {
        margin-top: 54px;
        margin-bottom: 54px;
        position: relative;
        z-index: 1;
      }

      :host header h1 {
        @apply(--placetobe-font-title);
        text-align: center;
        margin-bottom: 18px;
      }

      :host header h2 {
        @apply(--placetobe-font-heading1-regular);
        text-align: center;
      }

      placetobe-campaign-stats-card {
        max-width: var(--placetobe-layout-width);
        position: relative;
        z-index: 1;
        margin: 0 auto -118px auto;
        padding: 18px;
      }

      :host iron-image {
        margin-bottom: -4px;
        background-color: var(--placetobe-color-taupe);
      }

      :host #coverImage {
        width: 100%;
        height: 70vh;
        position: relative;
        z-index: 0;
      }

      :host main {
      }

      a.button {
        @apply(--placetobe-default-button);
      }

      :host #downloads {
        margin:0;
        padding: 0;
        list-style: none;
      }

      #downloads li {
        margin: 54px 0;
        padding: 0;
      }

      #downloads li h5 {
        @apply(--placetobe-font-heading1);
        margin: 0 0 18px 0;
      }

      #downloads li article {
        @apply(--placetobe-font-body-serif);
        margin: 18px 0;
      }

      #downloads li a {
        margin-top: 18px;
        display: inline-block;
        background-color: var(--placetobe-color-green);
      }

      :host main article {
        @apply(--placetobe-font-body);
        margin: 36px 0;
      }

      :host main article ::slotted(* strong),
      :host main article ::slotted(* bold) {
        @apply(--placetobe-font-body-bold);
      }

      :host main article ::slotted(div h3),
      :host main article h3,
      :host main article ::slotted(* h3) {
        @apply(--placetobe-font-heading4);        
      }

      :host main article ::slotted(* iframe) {
        width: 100%;        
      }

      :host main article ::slotted(* img) {
        width: 100%;
        height: auto;
      }

      :host main article ::slotted(* a) {
        color: var(--placetobe-color-darkblue);
      }

      :host placetobe-navigation-bar[data-sticky] {
        position: fixed;
        top:0;
        left: 0;
        right: 0;
        z-index: 10;
      }

      :host footer {
        margin: 0 auto -100px auto;
        position: relative;
        z-index: 1;
      }

      #invest-page {
        position: fixed;
        top: 80px;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 9;
        border: 0;
        width: 100vw;
        height: 100vh;
        background-color: white;
      }

      google-youtube {
        margin-top: 36px;
      }

    </style>

    <template is="dom-if" if="[[showInvestPage]]">
    <iframe
      id="invest-page"
      src$="http://can.local/widget/#/[[campaignId]]/investeer"
    ></iframe>
    </template>

    <placetobe-navigation-bar hidden$="[[!showInvestPage]]" data-sticky>
      <li slot="navigation" data-selected$="[[showStory]]"><a href$="/campagnes/[[campaignId]]/verhaal">[[title]]</a></li>
      <li slot="navigation" data-selected$="[[showDownloads]]"><a href$="/campagnes/[[campaignId]]/downloads">Downloads</a></li>
      <a slot="footer" class="button" href$="/campagnes/[[campaignId]]/investeer">investeer</a>
    </placetobe-navigation-bar>

    <app-location
      route="{{campaignRoute}}"
      path="{{campaignPath}}"
      url-space-regex="^/campagnes/(.*?)"
    ></app-location>

    <app-route
      route="{{campaignRoute}}"
      pattern="/campagnes/:slug"
      tail="{{campaignPageSection}}"
    ></app-route>

    <app-route
      route="{{campaignPageSection}}"
      pattern="/:section"
      data="{{pageParams}}"
    ></app-route>

    <caas-campaign
      api-endpoint="[[apiEndpoint]]"
      id="[[campaignId]]"
      title="{{title}}"
      introduction-text="{{introductionText}}"
      image-url="{{imageUrl}}"
      body-text="{{campaignText}}"
    ></caas-campaign>

    <caas-campaign-files
      api-endpoint="[[apiEndpoint]]"
      campaign-id="[[campaignId]]"
      files="{{downloads}}"
    ></caas-campaign-files>

      <placetobe-navigation-bar id="stickyNavigationBar" hidden$="[[stickyNavBarHidden]]" data-sticky>
        <li slot="navigation" data-selected$="[[showStory]]"><a href$="/campagnes/[[campaignId]]/verhaal">[[title]]</a></li>
        <li slot="navigation" data-selected$="[[showDownloads]]"><a href$="/campagnes/[[campaignId]]/downloads">Downloads</a></li>
        <a slot="footer" class="button" href$="/campagnes/[[campaignId]]/investeer">investeer</a>
      </placetobe-navigation-bar>

      <header>
        <h1>[[title]]</h1>
        <h2>[[introductionText]]</h2>
      </header>

    <template is="dom-if" if="[[showStory]]">
      <placetobe-campaign-stats-card
        api-endpoint="[[apiEndpoint]]"
        campaign-id="[[campaignId]]"
      ></placetobe-campaign-stats-card>

      <iron-image
        id="coverImage"
        preload
        fade
        sizing="cover"
        src="[[imageUrl]]"
      ></iron-image>
    </template>

    <placetobe-navigation-bar id="navigationBar">
        <li slot="navigation" data-selected$="[[showStory]]"><a href$="/campagnes/[[campaignId]]/verhaal">[[title]]</a></li>
        <li slot="navigation" data-selected$="[[showDownloads]]"><a href$="/campagnes/[[campaignId]]/downloads">Downloads</a></li>
        <a slot="footer" class="button" href$="/campagnes/[[campaignId]]/investeer">investeer</a>
    </placetobe-navigation-bar>

    <main>

      <google-youtube
        hidden$="[[!showStory]]"
        video-id="ETfiUYij5UE"
        height="400px"
        width="100%"
        rel="0"
        start="5"
        autoplay="0">
      </google-youtube>

      <article id="campaignText" hidden$="[[!showStory]]"></article>

      <template is="dom-if" if="[[showDownloads]]">
        <ul id="downloads">
          <template is="dom-repeat" items="[[downloads]]">
          <li>
            <h5>[[item.name]]</h5>
            <article hidden$="[[!item.description]]">[[item.description]]</article>
            <a class="button" href$="[[item.url]]" download>download bestand</a>
          </li>
          </template>
        </ul>
      </template>

    </main>

    <template is="dom-if" if="[[showStory]]">

    <footer>
      <placetobe-campaign-stats-card
        api-endpoint="[[apiEndpoint]]"
        campaign-id="[[campaignId]]"
      ></placetobe-campaign-stats-card>
    </footer>

    <iron-image
      id="coverImage"
      preload
      fade
      sizing="cover"
      src="[[imageUrl]]"
    ></iron-image>

    </template>

  </template>

  <script>
    Polymer({

      is: 'placetobe-campaign-page',
      behaviors: [PlacetobeStylesBehavior],

      behaviors: [PlacetobeStylesBehavior],

      ready: function() {
        this._setScrollPositions();
        window.addEventListener('scroll', this._setScrollPositions.bind(this))
        window.addEventListener('resize', this._setScrollPositions.bind(this))
      },

      attached: function() {
        this._setScrollPositions();
      },

      properties: {
        
        apiEndpoint: {
          type: String,
          value: null,
        },

        campaignId: {
          type: String,
          value: null,          
        },

        campaignText: {
          type: String,
          value: null,
          observer: '_parseCampaignText'
        },

        stickyNavBarHidden: {
          type: Boolean,
          computed: '_computeStickyNavBarHidden(_scrollY, _navigationBarY)'
        },

        _scrollY: {
          type: Number,
          value: 0
        },

        _navigationBarY: {
          type: Number,
          value: 0          
        },

        pageParams: {
          type: Object,
          value: null
        },

        showDownloads: {
          type: Boolean,
          computed: '_computeShowDownloads(pageParams.section)'
        },

        showStory: {
          type: Boolean,
          computed: '_computeShowStory(pageParams.section)'
        },

        showInvestPage: {
          type: Boolean,
          computed: '_computeShowInvestPage(pageParams.section)'
        }

      },

      _setScrollPositions: function(evt) {
        this._scrollY = window.document.body.scrollTop;
        this._navigationBarY = this.$.navigationBar.offsetTop;
      },

      _parseCampaignText: function(campaignText) {
        this.$.campaignText.innerHTML = campaignText;
      },

      _computeStickyNavBarHidden: function(scrollY, navigationBarY) {
        return (scrollY <= navigationBarY);
      },

      _computeShowStory: function(pageSection) {
        return (!pageSection || pageSection == 'verhaal');
      },

      _computeShowDownloads: function(pageSection) {
        return (pageSection === 'downloads');
      },

      _computeShowInvestPage: function(pageSection) {
        return (pageSection === 'investeer');
      }

    });
  </script>
</dom-module>
